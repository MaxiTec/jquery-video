/*global window, $f, jQuery, YT, DM, document*/
!function(e){"use strict"
var t={_register:{},isRegistered:function(e){return void 0!==this._register[e]},isLoaded:function(e){return void 0!==this._register[e]&&this._register[e]===!0},register:function(e,t){t=t||!1,this._register[e]=t}}
e.widget("dcd.video",{_create:function(){switch(this.element.data("type")){case"youtube":this.element.videoYoutube(),this._player=this.element.data("dcdVideoYoutube")
break
case"vimeo":this.element.videoVimeo(),this._player=this.element.data("dcdVideoVimeo")
break
case"dailymotion":this.element.videoDailymotion(),this._player=this.element.data("dcdVideoDailymotion")
break
default:throw{name:"Video Error",message:"Unknown video type",toString:function(){return this.name+": "+this.message}}}},_initialize:function(){this._params=this.element.data("params")||{},this._code=this.element.data("code"),this._width=this.element.data("width"),this._height=this.element.data("height"),this._autoplay=!!this.element.data("autoplay"),this._rel=!!this.element.data("rel"),this._playing=this._autoplay||!1,this._responsive=!0,this.element.data("responsive")===!1&&(this._responsive=!1),this._responsive===!0&&this.element.addClass("responsive"),this._calculateRatio()},play:function(){this._player.play()},pause:function(){this._player.pause()},stop:function(){this._player.stop()},playing:function(){return this._player.playing()},_calculateRatio:function(){this._responsive&&this.element.css("paddingBottom",this._height/this._width*100+"%")}}),e.widget("dcd.videoYoutube",e.dcd.video,{_create:function(){var e=this
this._initialize(),this.element.append("<div/>"),this._on(window,{youtubeapiready:function(){void 0===e._player&&(e._autoplay&&(e._params.autoplay=1),e._rel||(e._params.rel=0),e._player=new YT.Player(e.element.children(":first")[0],{height:e._height,width:e._width,videoId:e._code,playerVars:e._params,events:{onStateChange:function(t){switch(window.parseInt(t.data,10)){case 1:e._playing=!0
break
default:e._playing=!1}e._trigger("statechange",{},t)}}}))}}),this._loadApi()},_loadApi:function(){if(t.isRegistered("youtube"))return void(t.isLoaded("youtube")&&e(window).trigger("youtubeapiready"))
t.register("youtube")
var i=document.createElement("script"),a=document.getElementsByTagName("script")[0]
i.async=!0,i.src=document.location.protocol+"//www.youtube.com/iframe_api",a.parentNode.insertBefore(i,a),window.onYouTubeIframeAPIReady=function(){e(window).trigger("youtubeapiready"),t.register("youtube",!0)}},play:function(){this._player.playVideo(),this._playing=!0},pause:function(){this._player.pauseVideo(),this._playing=!1},stop:function(){this._player.stopVideo(),this._playing=!1},playing:function(){return this._playing},_destroy:function(){this.stop(),this._player.destroy()}}),e.widget("dcd.videoVimeo",e.dcd.video,{_create:function(){this._initialize()
var t=(new Date).getTime(),i=""
this._autoplay&&(i+="&autoplay=1"),this._rel||(i+="&rel=0"),this.element.append(e("<iframe/>").attr("frameborder",0).attr("id","vimeo"+this._code+t).attr("width",this._width).attr("height",this._height).attr("src",document.location.protocol+"//player.vimeo.com/video/"+this._code+"?api=1&player_id=vimeo"+this._code+t+i)),this._player=$f(this.element.children(":first")[0]),this._player.addEvent("ready",function(){})},play:function(){this._player.api("play"),this._playing=!0},pause:function(){this._player.api("pause"),this._playing=!1},stop:function(){this._player.api("unload"),this._playing=!1},playing:function(){return this._playing}}),e.widget("dcd.videoDailymotion",e.dcd.video,{_create:function(){var e=this
this._initialize(),e._autoplay&&(e._params.autoplay=1),this.element.append("<div/>"),this._on(window,{dailymotionapiready:function(){void 0===e._player&&(e._player=DM.player(e.element.children(":first")[0],{height:e._height,width:e._width,video:e._code,params:e._params}))}}),this._loadApi()},_loadApi:function(){if(t.isRegistered("dailymotion"))return void(t.isLoaded("dailymotion")&&e(window).trigger("dailymotionapiready"))
t.register("dailymotion")
var i=document.createElement("script"),a=document.getElementsByTagName("script")[0]
i.async=!0,i.src=document.location.protocol+"//api.dmcdn.net/all.js",a.parentNode.insertBefore(i,a),window.dmAsyncInit=function(){e(window).trigger("dailymotionapiready"),t.register("dailymotion",!0)}},play:function(){this._player.play(),this._playing=!0},pause:function(){this._player.pause(),this._playing=!1},stop:function(){this._player.pause(),this._playing=!1},playing:function(){return this._playing}})}(jQuery)
